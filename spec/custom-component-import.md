# カスタムコンポーネント インポート機能 構想
> あくまで構想なので実装するかは不明

## 概要

既存の React アプリから `.tsx` ファイルをインポートし、Momoc のコンポーネントサイドバーにカスタムコンポーネントとして登録できる機能。既存資産の再利用によりユーザーの参入障壁を下げることが目的。

---

## ユーザーフロー

```
[Import ボタン] (コンポーネントサイドバー)
  ↓
ファイルダイアログ (.tsx / .moc を選択)
  ↓
インポート設定画面 (スタイル選択)
  ↓
骨格を編集画面に展開 → スタイル調整
  ↓
保存 → カスタムコンポーネントとして登録
  ↓
サイドバーの「カスタム」カテゴリに表示
```

---

## インポート設定画面

```
┌─ TSX インポート ────────────────────────────────┐
│                                                  │
│  ファイル: components/Card.tsx         [選択...]  │
│                                                  │
│  スタイル:                                        │
│  ○ Tailwind CSS    （そのまま取り込む）           │
│  ○ その他          （スタイルなしで取り込む）      │
│                                                  │
│  ※ Tailwind以外はスタイルの再現に限界があります  │
│                                                  │
│              [キャンセル]  [インポート]            │
└──────────────────────────────────────────────────┘
```

---

## TSX → craftState JSON 変換仕様

### 基本方針

TypeScript コンパイラ API で AST パースし、**JSX 骨格のみを抽出**して craftState JSON に変換する。ロジック部分は変換時に完全に破棄する。

### 残すもの（UI骨格）

- JSX の構造・要素・属性
- `className` / `style` などの見た目
- props のインターフェース（外から渡せるもの）
- 静的な文字列・定数

### 捨てるもの（ロジック）

- `useState` / `useReducer` / `useContext`
- `useEffect` / `useCallback` / `useMemo`
- イベントハンドラの中身（属性は残すが関数は空に）
- API 呼び出し・fetch・非同期処理

> **ロジックを捨てる理由:**
> - Web プレビューで API 呼び出しや副作用が走ると壊れる
> - AI による実装生成時に足かせになる
> - ロジックは用途ごとに書き直すものなので再利用しない

### ベストエフォート処理

| ケース | 対処 |
|--------|------|
| 条件分岐 `cond ? <A/> : <B/>` | else 側（または truthy 側）を採用 |
| リスト `.map(item => <Card/>)` | サンプル1件で展開 |
| 動的な値 `{variable}` | プレースホルダー文字列に置換 |
| 動的 className `cn("base", cond && "active")` | 静的部分のみ取得 |

### スタイル対応

| スタイル | 対応 |
|---------|------|
| **Tailwind CSS** | ✅ className をそのまま保持 |
| **inline style** | ✅ そのまま保持 |
| **それ以外** | className を空にして骨格のみ取り込む |

Bootstrap → Tailwind の自動変換は変換精度が保証できないため非対応。インポート後にユーザーが Tailwind で書き直す前提。

---

## 内部ストレージ

### 保存先

プロジェクトルートに `.momoc/components/` ディレクトリを作成して管理。

```
.momoc/
  components/
    Card.json        ← craftState JSON
    ProductHero.json
    ...
```

- Git で管理可能・チームで共有可能
- プロジェクト外への持ち出しは `.moc` エクスポートで対応

### JSON 構造（案）

```json
{
  "name": "Card",
  "importedFrom": "components/Card.tsx",
  "style": "tailwind",
  "craftState": { ... }
}
```

---

## コンポーネント管理 UI

サイドバーの「カスタム」カテゴリで右クリックメニューを提供。

```
[カスタム]
  Card          ▶ [編集] [名前変更] [削除] [複製]
  ProductHero   ▶ [編集] [名前変更] [削除] [複製]
```

- **編集**: craftState を編集画面に展開して再編集・保存
- **名前変更**: インポート時はファイル名から自動命名、後から変更可能
- **削除**: `.momoc/components/` から削除
- **複製**: 別名でコピーを作成

---

## .moc インポート / エクスポート

- **.moc インポート**: craftState をそのまま取り出してカスタムコンポーネントとして登録
- **.moc エクスポート**: カスタムコンポーネントを `.moc` ファイルとして書き出し（バックアップ・共有用）

---

## 実装フェーズ（案）

| Phase | 内容 | 難易度 |
|-------|------|--------|
| 1 | `.moc` インポート → craftState のテンプレートとして登録 | 低 |
| 2 | `.momoc/components/` への永続化 + サイドバー表示 | 中 |
| 3 | `.tsx` インポート → AST パース → craftState 変換 | 高 |

---

## 未解決課題

- Craft.js の `resolver` への動的コンポーネント登録方法（グローバルレジストリ経由が有力）
- AST 変換の精度（複雑なコンポーネントは手直しが必要になる場合がある）
- `.momoc/` ディレクトリの初期化タイミング
